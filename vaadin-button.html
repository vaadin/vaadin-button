<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--
`<vaadin-button>` is a Polymer element for customized buttons.

```html
<vaadin-button>
</vaadin-button>
```

@element vaadin-button
@demo demo/index.html
-->

<link rel="import" href="../polymer/polymer.html">

<dom-module id="vaadin-button">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
      }

      button {
        width: 100%;
        height: 100%;
      }
    </style>
    <button id="button"
        role="button"
        autofocus$="[[autofocus]]"
        disabled$="[[disabled]]"
        name="[[name]]"
        value="[[value]]"
        tabindex$="[[tabindex]]"
        on-focus="_onButtonFocus"
        on-blur="_onButtonBlur"
        on-keydown="_onButtonKeyDown">
      <slot></slot>
    </button>
  </template>
  <script>
    if (!window.Vaadin) window.Vaadin = {};

    Vaadin.ButtonElement = class VaadinButtonElement extends Polymer.Element {
      static get is() {
        return 'vaadin-button';
      }

      static get config() {
        return {
          properties: {
            /**
             * Specify that this control should have input focus when the page loads.
             */
            autofocus: {
              type: Boolean,
              reflectToAttribute: true
            },

            /**
             * Indicates that this control is not available for interaction.
             */
            disabled: {
              type: Boolean,
              reflectToAttribute: true,
              observer: '_disabledChanged',
            },

            /**
             * The position of the element in the tabbing navigation order for the current document.
             */
            tabindex: {
              type: Number,
              value: 0,
              reflectToAttribute: true,
              observer: '_tabindexChanged'
            },

            /**
             * If true, the element currently has focus.
             */
            focused: {
              type: Boolean,
              notify: true,
              readOnly: true,
              reflectToAttribute: true
            }
          }
        };
      }

      ready() {
        super.ready();

        this.addEventListener('focus', this._focus.bind(this));

        if (this.autofocus) {
          this.$.button.focus();
        }
      }

      _onButtonFocus() {
        this._setFocused(true);
      }

      _focus() {
        if (this.disabled) {
          this.blur();
        } else {
          this.$.button.focus();
        }
      }

      _onButtonBlur() {
        this._setFocused(false);
      }

      _onButtonKeyDown(e) {
        // shift-tab
        if (e.shiftKey && e.keyCode === 9) {
          this.focus();
        }
      }

      _disabledChanged(disabled) {
        if (disabled) {
          this._oldTabindex = this.tabindex;
          this.tabindex = -1;
        } else if (!disabled) {
          this.tabindex = this._oldTabindex || 0;
          this._oldTabindex = undefined;
        }
      }

      _tabindexChanged(tabindex) {
        if (this.disabled && tabindex != -1) {
          this._oldTabindex = tabindex;
        }
      }
    };

    customElements.define(Vaadin.ButtonElement.is, Vaadin.ButtonElement);
  </script>
</dom-module>
