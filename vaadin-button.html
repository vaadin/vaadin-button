<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--
`<vaadin-button>` is a Polymer element.

```html
<vaadin-button>
</vaadin-button>
```

@element vaadin-button
@demo demo/index.html
-->

<link rel="import" href="../polymer/polymer.html">

<dom-module id="vaadin-button">
  <template>
    <style>
      :host {
        align-items: flex-start;
        background: linear-gradient(to bottom right, #fff, #eee);
        border: 1px solid #999;
        border-radius: 2px;
        box-sizing: border-box;
        cursor: default;
        display: inline-block;
        font-size: 15px;
        letter-spacing: normal;
        margin: 0;
        padding: 2px 8px;
        text-align: center;
        text-indent: 0;
        text-rendering: auto;
        text-shadow: none;
        text-transform: none;
        word-spacing: normal;
        user-select: none;
      }

      :host(:hover) {
        border-color: #666;
      }

      :host([disabled]) {
        color: #aaa !important;
        background: #eee !important;
        border-color: #aaa !important;
        pointer-events: none;
      }

      :host([active]) {
        background: linear-gradient(to bottom right, #eee, #fff);
      }
    </style>
    <slot></slot>
  </template>

  <script>
    if (!window.Vaadin) window.Vaadin = {};

    const ENTER = 13;
    const SPACE = 32;

    Vaadin.ButtonElement = class VaadinButtonElement extends Polymer.Element {
      static get is() {
        return 'vaadin-button';
      }

      static get config() {
        return {
          properties: {
            /**
             * If true, the button is in the active state (clicked).
             */
            active: {
              type: Boolean,
              default: false,
              reflectToAttribute: true
            },

            /**
             * Specify that this control should have input focus when the page loads.
             */
            autofocus: {
              type: Boolean
            },

            /**
             * Indicates that this control is not available for interaction.
             */
            disabled: {
              type: Boolean,
              default: false,
              reflectToAttribute: true,
              observer: '_disabledChanged',
            },

            /**
             * role="button"
             */
            role: {
              type: String,
              value: 'button',
              reflectToAttribute: true,
              readOnly: true
            },

            /**
             * The position of the element in the tabbing navigation order for the current document.
             */
            tabindex: {
              type: Number,
              value: 0,
              reflectToAttribute: true
            },

            /**
             *
             */
            _previousTabIndex: Number
          }
        };
      }

      ready() {
        this._addListeners();

        super.ready();

        if (this.autofocus) {
          window.requestAnimationFrame(function() {
            this.focus();
          }.bind(this));
        }
      }

      activate(e) {
        this.active = true;
      }

      deactivate(e) {
        this.active = false;
      }

      _disabledChanged(disabled) {
        if (disabled) {
          this._previousTabIndex = this.tabindex;
          this.tabindex = null;
          this._removeListeners();
        } else {
          this.tabindex = this._previousTabIndex;
          this._addListeners();
        }
      }

      _addListeners() {
        this.addEventListener('down', this._handleDown.bind(this));
        this.addEventListener('up', this._handleUp.bind(this));
        this.addEventListener('keydown', this._handleKeyDown.bind(this));
        this.addEventListener('keyup', this._handleKeyUp.bind(this));
      }

      _removeListeners() {
        this.removeEventListener('down', this._handleDown);
        this.removeEventListener('up', this._handleUp);
        this.removeEventListener('keydown', this._handleKeyDown);
        this.removeEventListener('keyup', this._handleKeyUp);
      }

      _handleDown(e) {
        if (e.which === 1) { // left button
          this.activate(e);
        }
      }

      _handleUp(e) {
        if (e.which === 1) { // left button
          this.deactivate(e);
        }
      }

      _handleKeyDown(e) {
        if (e.keyCode === ENTER || e.keyCode === SPACE) {
          e.preventDefault();
          Polymer.Base.fire('click', e, {
            bubbles: false,
            node: this
          });
          this.activate(e);
        }
      }

      _handleKeyUp(e) {
        if (e.keyCode === ENTER || e.keyCode === SPACE) {
          this.deactivate(e);
        }
      }
    };

    customElements.define(Vaadin.ButtonElement.is, Vaadin.ButtonElement);
  </script>
</dom-module>
